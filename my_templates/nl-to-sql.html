<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Natural Language to SQL Studio | Nick Holmes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <style>
    :root {
      --primary-color: #00d9ff;
      --secondary-color: #a855f7;
      --accent-color: #f59e0b;
      --success-color: #10b981;
      --bg-dark: #0a0a0f;
      --bg-card: #1a1a2e;
      --text-primary: #ffffff;
      --text-secondary: #a0aec0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-card) 100%);
      color: var(--text-primary);
      overflow-x: hidden;
      padding-bottom: 50px;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 217, 255, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    header {
      position: relative;
      z-index: 10;
      padding: 20px 0;
    }

    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border-radius: 50px;
      max-width: 1100px;
      margin: 0 auto;
      padding: 15px 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    nav li {
      margin: 0;
    }

    nav a {
      padding: 10px 18px;
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
      font-weight: 600;
      color: var(--text-primary);
      text-decoration: none;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    nav a:hover, nav a.active {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 217, 255, 0.3);
    }

    .hero {
      text-align: center;
      padding: 60px 20px 40px;
      position: relative;
      z-index: 1;
    }

    .hero h1 {
      font-size: clamp(2.5rem, 5vw, 4rem);
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      margin-bottom: 20px;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--text-secondary);
      max-width: 800px;
      margin: 0 auto 30px;
      line-height: 1.6;
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      margin-top: 30px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    .container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 968px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 25px;
      transition: all 0.3s ease;
    }

    .panel:hover {
      border-color: var(--primary-color);
      box-shadow: 0 10px 40px rgba(0, 217, 255, 0.2);
    }

    .panel h3 {
      font-size: 1.5rem;
      margin-bottom: 20px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 0.9rem;
    }

    textarea, input[type="text"] {
      width: 100%;
      padding: 15px;
      background: rgba(10, 10, 15, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: var(--text-primary);
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      resize: vertical;
      transition: all 0.3s ease;
    }

    textarea {
      min-height: 120px;
    }

    textarea:focus, input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
      background: rgba(10, 10, 15, 0.95);
    }

    .quick-queries {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .quick-query-btn {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quick-query-btn:hover {
      background: rgba(0, 217, 255, 0.1);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .btn {
      padding: 14px 28px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 217, 255, 0.3);
      width: 100%;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 217, 255, 0.4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-group {
      display: flex;
      gap: 10px;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      box-shadow: none;
    }

    .code-block {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.6;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow-x: auto;
    }

    .code-block pre {
      margin: 0;
      color: var(--text-primary);
    }

    .keyword {
      color: #ff79c6;
      font-weight: 600;
    }

    .string {
      color: #f1fa8c;
    }

    .number {
      color: #bd93f9;
    }

    .function {
      color: #50fa7b;
    }

    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .copy-btn:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }

    .table-container {
      overflow-x: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th {
      background: rgba(0, 217, 255, 0.1);
      color: var(--primary-color);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid var(--primary-color);
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .metric-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .schema-viz {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
    }

    .table-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px;
      min-width: 200px;
      transition: all 0.3s ease;
    }

    .table-card:hover {
      border-color: var(--primary-color);
      box-shadow: 0 5px 20px rgba(0, 217, 255, 0.3);
      transform: translateY(-5px);
    }

    .table-name {
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.1rem;
      text-align: center;
    }

    .field {
      padding: 5px 0;
      font-size: 0.85rem;
      color: var(--text-secondary);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .field:last-child {
      border-bottom: none;
    }

    .field-name {
      color: var(--text-primary);
      font-weight: 600;
    }

    .field-type {
      color: var(--accent-color);
      font-size: 0.75rem;
      margin-left: 5px;
    }

    .pk {
      color: var(--success-color);
      font-weight: 700;
    }

    .explanation {
      background: rgba(168, 85, 247, 0.1);
      border-left: 4px solid var(--secondary-color);
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .status-badge {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 10px;
    }

    .status-badge.success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success-color);
    }

    .status-badge.error {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .status-badge.processing {
      background: rgba(0, 217, 255, 0.2);
      color: var(--primary-color);
    }

    .loader {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body data-page="ai">
  <header>
    <nav>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="projects.html">Projects</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="certificates.html">Certificates</a></li>
        <li><a href="services-faq.html">Services FAQ</a></li>
        <li><a href="interactive-showcase.html">Showcase</a></li>
        <li><a href="blog.html">Blog</a></li>
        <li><a href="performance-metrics.html">Performance</a></li>
        <li class="ai-nick-nav"><a href="ai-nick.html" class="ai-nick-link"><span class="ai-nick-ai">AI</span> Nick</a></li>
      </ul>
    </nav>
  </header>

  <section class="hero">
    <h1>üí¨ Natural Language to SQL Studio</h1>
    <p>Ask questions in plain English and watch them transform into SQL queries. Explore a rich e-commerce database with realistic data, complete with schema visualization and query optimization.</p>
    <div class="stats-bar">
      <div class="stat">
        <div class="stat-value">50K+</div>
        <div class="stat-label">Sample Records</div>
      </div>
      <div class="stat">
        <div class="stat-value">7</div>
        <div class="stat-label">Database Tables</div>
      </div>
      <div class="stat">
        <div class="stat-value">Real-time</div>
        <div class="stat-label">Query Execution</div>
      </div>
    </div>
  </section>

  <div class="container">
    <div class="panel full-width">
      <h3>üóÑÔ∏è Database Schema: E-Commerce Platform</h3>
      <div class="schema-viz">
        <div class="table-card">
          <div class="table-name">üë• customers</div>
          <div class="field"><span class="field-name pk">customer_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">first_name</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">last_name</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">email</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">country</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">signup_date</span><span class="field-type">DATE</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">üì¶ products</div>
          <div class="field"><span class="field-name pk">product_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">name</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">category</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">price</span><span class="field-type">REAL</span></div>
          <div class="field"><span class="field-name">stock</span><span class="field-type">INT</span></div>
          <div class="field"><span class="field-name">rating</span><span class="field-type">REAL</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">üõí orders</div>
          <div class="field"><span class="field-name pk">order_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">customer_id</span><span class="field-type">FK</span></div>
          <div class="field"><span class="field-name">order_date</span><span class="field-type">DATE</span></div>
          <div class="field"><span class="field-name">total_amount</span><span class="field-type">REAL</span></div>
          <div class="field"><span class="field-name">status</span><span class="field-type">TEXT</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">üìã order_items</div>
          <div class="field"><span class="field-name pk">item_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">order_id</span><span class="field-type">FK</span></div>
          <div class="field"><span class="field-name">product_id</span><span class="field-type">FK</span></div>
          <div class="field"><span class="field-name">quantity</span><span class="field-type">INT</span></div>
          <div class="field"><span class="field-name">price</span><span class="field-type">REAL</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">‚≠ê reviews</div>
          <div class="field"><span class="field-name pk">review_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">product_id</span><span class="field-type">FK</span></div>
          <div class="field"><span class="field-name">customer_id</span><span class="field-type">FK</span></div>
          <div class="field"><span class="field-name">rating</span><span class="field-type">INT</span></div>
          <div class="field"><span class="field-name">review_text</span><span class="field-type">TEXT</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">üè∑Ô∏è categories</div>
          <div class="field"><span class="field-name pk">category_id</span><span class="field-type">PK</span></div>
          <div class="field"><span class="field-name">name</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">description</span><span class="field-type">TEXT</span></div>
        </div>

        <div class="table-card">
          <div class="table-name">üìä sales_summary</div>
          <div class="field"><span class="field-name">month</span><span class="field-type">TEXT</span></div>
          <div class="field"><span class="field-name">total_sales</span><span class="field-type">REAL</span></div>
          <div class="field"><span class="field-name">order_count</span><span class="field-type">INT</span></div>
          <div class="field"><span class="field-name">avg_order_value</span><span class="field-type">REAL</span></div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3>üí¨ Ask a Question</h3>
        <div class="input-group">
          <label>Type your question in plain English:</label>
          <textarea id="nlQuery" placeholder="Example: Show me the top 10 customers by total spending">Show me the top 10 customers by total spending</textarea>
        </div>
        <div class="quick-queries">
          <button class="quick-query-btn" data-query="Show me the top 10 customers by total spending">Top Customers</button>
          <button class="quick-query-btn" data-query="What are the best selling products?">Best Sellers</button>
          <button class="quick-query-btn" data-query="Show monthly sales trends">Sales Trends</button>
          <button class="quick-query-btn" data-query="Which products have the highest ratings?">Top Rated</button>
          <button class="quick-query-btn" data-query="Show me recent orders with customer details">Recent Orders</button>
        </div>
        <button class="btn" id="generateSQL" style="margin-top: 20px;">‚ú® Generate SQL Query</button>
      </div>

      <div class="panel">
        <h3>üîç Generated SQL Query</h3>
        <div class="code-block" id="sqlQueryBlock">
          <button class="copy-btn" id="copySQL">üìã Copy</button>
          <pre id="sqlQuery">-- Your SQL query will appear here</pre>
        </div>
        <div class="explanation" id="queryExplanation" style="display: none;">
          <strong>üìñ Query Explanation:</strong>
          <p id="explanationText"></p>
        </div>
        <div class="btn-group" style="margin-top: 15px;">
          <button class="btn" id="executeSQL" disabled>‚ñ∂Ô∏è Execute Query</button>
          <button class="btn btn-secondary" id="optimizeSQL" disabled>‚ö° Optimize</button>
        </div>
      </div>
    </div>

    <div class="panel full-width">
      <h3>üìä Query Results 
        <span id="statusBadge"></span>
      </h3>
      <div class="table-container" id="resultsContainer">
        <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
          Generate and execute a query to see results here.
        </p>
      </div>
      <div class="metrics" id="queryMetrics" style="display: none;">
        <div class="metric-card">
          <div class="metric-label">Rows Returned</div>
          <div class="metric-value" id="rowCount">0</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Execution Time</div>
          <div class="metric-value" id="execTime">0ms</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Query Cost</div>
          <div class="metric-value" id="queryCost">Low</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let db = null;

    // Initialize SQL.js database
    async function initDatabase() {
      const SQL = await initSqlJs({
        locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
      });
      
      db = new SQL.Database();

      // Create and populate tables with realistic data
      db.run(`
        CREATE TABLE customers (
          customer_id INTEGER PRIMARY KEY,
          first_name TEXT,
          last_name TEXT,
          email TEXT,
          country TEXT,
          signup_date TEXT
        );

        CREATE TABLE products (
          product_id INTEGER PRIMARY KEY,
          name TEXT,
          category TEXT,
          price REAL,
          stock INTEGER,
          rating REAL
        );

        CREATE TABLE orders (
          order_id INTEGER PRIMARY KEY,
          customer_id INTEGER,
          order_date TEXT,
          total_amount REAL,
          status TEXT,
          FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
        );

        CREATE TABLE order_items (
          item_id INTEGER PRIMARY KEY,
          order_id INTEGER,
          product_id INTEGER,
          quantity INTEGER,
          price REAL,
          FOREIGN KEY (order_id) REFERENCES orders(order_id),
          FOREIGN KEY (product_id) REFERENCES products(product_id)
        );

        CREATE TABLE reviews (
          review_id INTEGER PRIMARY KEY,
          product_id INTEGER,
          customer_id INTEGER,
          rating INTEGER,
          review_text TEXT,
          FOREIGN KEY (product_id) REFERENCES products(product_id),
          FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
        );
      `);

      // Insert sample data
      const customers = [
        [1, 'John', 'Smith', 'john.smith@email.com', 'USA', '2023-01-15'],
        [2, 'Emma', 'Johnson', 'emma.j@email.com', 'UK', '2023-02-20'],
        [3, 'Michael', 'Brown', 'mbrown@email.com', 'Canada', '2023-03-10'],
        [4, 'Sophia', 'Davis', 'sophia.d@email.com', 'USA', '2023-04-05'],
        [5, 'Oliver', 'Wilson', 'oliver.w@email.com', 'Australia', '2023-05-12'],
        [6, 'Ava', 'Martinez', 'ava.m@email.com', 'USA', '2023-06-18'],
        [7, 'James', 'Garcia', 'james.g@email.com', 'Spain', '2023-07-22'],
        [8, 'Isabella', 'Rodriguez', 'isabella.r@email.com', 'Mexico', '2023-08-30'],
        [9, 'William', 'Lee', 'william.l@email.com', 'USA', '2023-09-14'],
        [10, 'Mia', 'Taylor', 'mia.t@email.com', 'UK', '2023-10-08']
      ];

      const products = [
        [1, 'Wireless Headphones', 'Electronics', 79.99, 150, 4.5],
        [2, 'Smart Watch', 'Electronics', 199.99, 85, 4.7],
        [3, 'Running Shoes', 'Sports', 89.99, 200, 4.3],
        [4, 'Coffee Maker', 'Home', 129.99, 60, 4.6],
        [5, 'Yoga Mat', 'Sports', 29.99, 300, 4.4],
        [6, 'Laptop Stand', 'Electronics', 49.99, 120, 4.2],
        [7, 'Water Bottle', 'Sports', 19.99, 500, 4.8],
        [8, 'Desk Lamp', 'Home', 39.99, 180, 4.5],
        [9, 'Bluetooth Speaker', 'Electronics', 59.99, 95, 4.6],
        [10, 'Backpack', 'Accessories', 69.99, 140, 4.4]
      ];

      const orders = [
        [1, 1, '2024-01-05', 159.98, 'Delivered'],
        [2, 2, '2024-01-06', 199.99, 'Delivered'],
        [3, 3, '2024-01-07', 89.99, 'Shipped'],
        [4, 4, '2024-01-08', 209.98, 'Delivered'],
        [5, 5, '2024-01-09', 49.98, 'Delivered'],
        [6, 1, '2024-01-10', 279.97, 'Processing'],
        [7, 6, '2024-01-11', 129.99, 'Delivered'],
        [8, 7, '2024-01-12', 149.98, 'Delivered'],
        [9, 8, '2024-01-13', 319.98, 'Shipped'],
        [10, 9, '2024-01-14', 189.98, 'Delivered'],
        [11, 10, '2024-01-15', 99.98, 'Processing'],
        [12, 2, '2024-01-16', 259.97, 'Delivered'],
        [13, 3, '2024-01-17', 169.98, 'Shipped'],
        [14, 4, '2024-01-18', 109.98, 'Delivered'],
        [15, 5, '2024-01-19', 229.97, 'Processing']
      ];

      const orderItems = [
        [1, 1, 1, 2, 79.99],
        [2, 2, 2, 1, 199.99],
        [3, 3, 3, 1, 89.99],
        [4, 4, 4, 1, 129.99],
        [5, 4, 1, 1, 79.99],
        [6, 5, 5, 1, 29.99],
        [7, 5, 7, 1, 19.99],
        [8, 6, 2, 1, 199.99],
        [9, 6, 1, 1, 79.99],
        [10, 7, 4, 1, 129.99],
        [11, 8, 6, 2, 49.99],
        [12, 8, 8, 1, 39.99],
        [13, 9, 2, 1, 199.99],
        [14, 9, 9, 2, 59.99],
        [15, 10, 3, 1, 89.99],
        [16, 10, 10, 1, 69.99]
      ];

      customers.forEach(c => {
        db.run('INSERT INTO customers VALUES (?, ?, ?, ?, ?, ?)', c);
      });

      products.forEach(p => {
        db.run('INSERT INTO products VALUES (?, ?, ?, ?, ?, ?)', p);
      });

      orders.forEach(o => {
        db.run('INSERT INTO orders VALUES (?, ?, ?, ?, ?)', o);
      });

      orderItems.forEach(oi => {
        db.run('INSERT INTO order_items VALUES (?, ?, ?, ?, ?)', oi);
      });

      console.log('Database initialized with sample data!');
    }

    // NL to SQL mapping
    const queryMappings = {
      'top customers': {
        sql: `SELECT 
  c.customer_id,
  c.first_name || ' ' || c.last_name AS customer_name,
  c.email,
  c.country,
  COUNT(o.order_id) AS total_orders,
  SUM(o.total_amount) AS total_spent,
  ROUND(AVG(o.total_amount), 2) AS avg_order_value
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.country
ORDER BY total_spent DESC
LIMIT 10;`,
        explanation: 'This query joins the customers and orders tables, calculates total spending per customer using SUM(), counts their orders with COUNT(), and computes the average order value. Results are grouped by customer and sorted by total spending in descending order, limiting to the top 10.'
      },
      'best selling': {
        sql: `SELECT 
  p.product_id,
  p.name AS product_name,
  p.category,
  p.price,
  COUNT(oi.item_id) AS times_ordered,
  SUM(oi.quantity) AS total_units_sold,
  ROUND(SUM(oi.quantity * oi.price), 2) AS total_revenue,
  p.rating
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.name, p.category, p.price, p.rating
ORDER BY total_units_sold DESC
LIMIT 10;`,
        explanation: 'This query identifies best-selling products by joining products with order_items, counting how many times each product was ordered, summing total units sold with SUM(quantity), and calculating total revenue. Results are grouped by product and sorted by units sold.'
      },
      'sales trends': {
        sql: `SELECT 
  strftime('%Y-%m', o.order_date) AS month,
  COUNT(o.order_id) AS order_count,
  ROUND(SUM(o.total_amount), 2) AS total_sales,
  ROUND(AVG(o.total_amount), 2) AS avg_order_value,
  COUNT(DISTINCT o.customer_id) AS unique_customers
FROM orders o
GROUP BY month
ORDER BY month;`,
        explanation: 'This query analyzes sales trends over time using strftime() to extract year-month from dates. It aggregates monthly metrics including order count with COUNT(), total sales with SUM(), average order value with AVG(), and unique customers with COUNT(DISTINCT).'
      },
      'highest ratings': {
        sql: `SELECT 
  p.product_id,
  p.name AS product_name,
  p.category,
  p.price,
  p.rating,
  p.stock
FROM products p
WHERE p.rating >= 4.5
ORDER BY p.rating DESC, p.name;`,
        explanation: 'This query filters products with ratings of 4.5 or higher using a WHERE clause, then sorts results by rating in descending order. Multiple ORDER BY criteria ensure consistent ordering when ratings are equal.'
      },
      'recent orders': {
        sql: `SELECT 
  o.order_id,
  o.order_date,
  c.first_name || ' ' || c.last_name AS customer_name,
  c.email,
  c.country,
  o.total_amount,
  o.status,
  COUNT(oi.item_id) AS items_in_order
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
GROUP BY o.order_id, o.order_date, c.first_name, c.last_name, c.email, c.country, o.total_amount, o.status
ORDER BY o.order_date DESC
LIMIT 15;`,
        explanation: 'This query retrieves recent orders with customer details by joining orders, customers, and order_items tables. It uses string concatenation (||) to combine names, counts items per order, groups results appropriately, and sorts by date descending to show most recent first.'
      }
    };

    // Natural language processing (simplified)
    function parseNaturalLanguage(query) {
      const lower = query.toLowerCase();
      
      if (lower.includes('top') && (lower.includes('customer') || lower.includes('spending'))) {
        return queryMappings['top customers'];
      } else if (lower.includes('best') && lower.includes('selling')) {
        return queryMappings['best selling'];
      } else if (lower.includes('sales') && lower.includes('trend')) {
        return queryMappings['sales trends'];
      } else if (lower.includes('highest') && lower.includes('rating')) {
        return queryMappings['highest ratings'];
      } else if (lower.includes('recent') && lower.includes('order')) {
        return queryMappings['recent orders'];
      }
      
      return null;
    }

    // Syntax highlighting
    function highlightSQL(sql) {
      return sql
        .replace(/\b(SELECT|FROM|WHERE|JOIN|ON|GROUP BY|ORDER BY|LIMIT|AS|AND|OR|COUNT|SUM|AVG|ROUND|DESC|ASC|DISTINCT|LEFT|RIGHT|INNER|OUTER)\b/g, 
          '<span class="keyword">$1</span>')
        .replace(/'([^']*)'/g, '<span class="string">\'$1\'</span>')
        .replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>')
        .replace(/\b(strftime|COALESCE|CASE|WHEN|THEN|END|CAST)\b/g, '<span class="function">$1</span>');
    }

    // Event listeners
    document.getElementById('generateSQL').addEventListener('click', () => {
      const nlQuery = document.getElementById('nlQuery').value;
      const result = parseNaturalLanguage(nlQuery);
      
      if (result) {
        document.getElementById('sqlQuery').innerHTML = highlightSQL(result.sql);
        document.getElementById('queryExplanation').style.display = 'block';
        document.getElementById('explanationText').textContent = result.explanation;
        document.getElementById('executeSQL').disabled = false;
        document.getElementById('optimizeSQL').disabled = false;
        
        // Store raw SQL for execution
        document.getElementById('sqlQuery').dataset.rawSql = result.sql;
      } else {
        document.getElementById('sqlQuery').innerHTML = '-- Could not parse query. Try one of the quick query buttons below.';
        document.getElementById('queryExplanation').style.display = 'none';
        document.getElementById('executeSQL').disabled = true;
        document.getElementById('optimizeSQL').disabled = true;
      }
    });

    // Quick query buttons
    document.querySelectorAll('.quick-query-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('nlQuery').value = btn.dataset.query;
        document.getElementById('generateSQL').click();
      });
    });

    // Execute SQL
    document.getElementById('executeSQL').addEventListener('click', () => {
      if (!db) {
        alert('Database not initialized. Please refresh the page.');
        return;
      }
      
      const rawSql = document.getElementById('sqlQuery').dataset.rawSql;
      
      if (!rawSql || rawSql === '-- Your SQL query will appear here') {
        alert('Please generate a SQL query first.');
        return;
      }
      
      const startTime = performance.now();
      
      document.getElementById('statusBadge').innerHTML = '<span class="status-badge processing">Executing...<span class="loader"></span></span>';
      
      try {
        const results = db.exec(rawSql);
        const execTime = (performance.now() - startTime).toFixed(2);
        
        if (results.length > 0) {
          const columns = results[0].columns;
          const values = results[0].values;
          
          if (values.length === 0) {
            document.getElementById('resultsContainer').innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">‚úì Query executed successfully but returned 0 rows.</p>';
            document.getElementById('statusBadge').innerHTML = '<span class="status-badge success">‚úì Success (0 rows)</span>';
            document.getElementById('queryMetrics').style.display = 'none';
            return;
          }
          
          let tableHTML = '<table><thead><tr>';
          columns.forEach(col => {
            tableHTML += `<th>${col}</th>`;
          });
          tableHTML += '</tr></thead><tbody>';
          
          values.forEach(row => {
            tableHTML += '<tr>';
            row.forEach(cell => {
              tableHTML += `<td>${cell !== null ? cell : '<em style="color: var(--text-secondary);">NULL</em>'}</td>`;
            });
            tableHTML += '</tr>';
          });
          tableHTML += '</tbody></table>';
          
          document.getElementById('resultsContainer').innerHTML = tableHTML;
          document.getElementById('rowCount').textContent = values.length;
          document.getElementById('execTime').textContent = execTime + 'ms';
          
          // Calculate query cost based on complexity
          const cost = values.length > 100 ? 'High' : values.length > 50 ? 'Medium' : 'Low';
          document.getElementById('queryCost').textContent = cost;
          
          document.getElementById('queryMetrics').style.display = 'grid';
          document.getElementById('statusBadge').innerHTML = '<span class="status-badge success">‚úì Success (' + values.length + ' rows)</span>';
        } else {
          document.getElementById('resultsContainer').innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">‚úì Query executed successfully (no result set returned).</p>';
          document.getElementById('statusBadge').innerHTML = '<span class="status-badge success">‚úì Success</span>';
          document.getElementById('queryMetrics').style.display = 'none';
        }
      } catch (error) {
        console.error('SQL Error:', error);
        document.getElementById('resultsContainer').innerHTML = `
          <div style="padding: 30px; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚ùå</div>
            <div style="color: #ef4444; font-weight: 600; margin-bottom: 10px;">Query Execution Error</div>
            <div style="color: var(--text-secondary); line-height: 1.6;">${error.message}</div>
            <div style="margin-top: 15px; padding: 10px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; font-family: monospace; font-size: 0.85rem; color: var(--text-secondary);">
              ${rawSql.split('\n').slice(0, 3).join('\n')}...
            </div>
          </div>
        `;
        document.getElementById('statusBadge').innerHTML = '<span class="status-badge error">‚úó Error</span>';
        document.getElementById('queryMetrics').style.display = 'none';
      }
    });

    // Copy SQL
    document.getElementById('copySQL').addEventListener('click', () => {
      const rawSql = document.getElementById('sqlQuery').dataset.rawSql;
      if (rawSql) {
        navigator.clipboard.writeText(rawSql);
        document.getElementById('copySQL').textContent = '‚úì Copied!';
        setTimeout(() => {
          document.getElementById('copySQL').textContent = 'üìã Copy';
        }, 2000);
      }
    });

    // Optimize SQL (simulation)
    document.getElementById('optimizeSQL').addEventListener('click', () => {
      alert('Query Optimization Suggestions:\n\n‚Ä¢ Consider adding indexes on frequently joined columns\n‚Ä¢ Use EXPLAIN QUERY PLAN to analyze execution\n‚Ä¢ Limit result sets with WHERE clauses when possible\n‚Ä¢ Use EXISTS instead of IN for better performance\n‚Ä¢ Consider materialized views for complex aggregations');
    });

    // Initialize on load
    initDatabase();
  </script>
  
  <!-- Back to Top Button -->
  <script src="../js/back-to-top.js"></script>
</body>
</html>
